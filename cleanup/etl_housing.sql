CREATE DATABASE IF NOT EXISTS etl_project;
USE etl_project;

SELECT * FROM housing_price LIMIT 25;

-- get queries for dates out of range
SELECT CONCAT('DROP COLUMN `', COLUMN_NAME, '`,')
FROM INFORMATION_SCHEMA.columns
WHERE (
	TABLE_NAME = 'housing_price'
	AND TABLE_SCHEMA = 'etl_project'
)
AND (
	left(COLUMN_NAME, 4) < '2010'
	OR left(COLUMN_NAME, 4) > '2016'
)
AND	(
	COLUMN_NAME <> 'RegionName'
	AND COLUMN_NAME <> 'SizeRank'
);

-- alter table here with copied queries
ALTER TABLE housing_price
	DROP COLUMN `1996-04`,
	DROP COLUMN `1996-05`,
	DROP COLUMN `1996-06`,
	DROP COLUMN `1996-07`,
	DROP COLUMN `1996-08`,
	DROP COLUMN `1996-09`,
	DROP COLUMN `1996-10`,
	DROP COLUMN `1996-11`,
	DROP COLUMN `1996-12`,
	DROP COLUMN `1997-01`,
	DROP COLUMN `1997-02`,
	DROP COLUMN `1997-03`,
	DROP COLUMN `1997-04`,
	DROP COLUMN `1997-05`,
	DROP COLUMN `1997-06`,
	DROP COLUMN `1997-07`,
	DROP COLUMN `1997-08`,
	DROP COLUMN `1997-09`,
	DROP COLUMN `1997-10`,
	DROP COLUMN `1997-11`,
	DROP COLUMN `1997-12`,
	DROP COLUMN `1998-01`,
	DROP COLUMN `1998-02`,
	DROP COLUMN `1998-03`,
	DROP COLUMN `1998-04`,
	DROP COLUMN `1998-05`,
	DROP COLUMN `1998-06`,
	DROP COLUMN `1998-07`,
	DROP COLUMN `1998-08`,
	DROP COLUMN `1998-09`,
	DROP COLUMN `1998-10`,
	DROP COLUMN `1998-11`,
	DROP COLUMN `1998-12`,
	DROP COLUMN `1999-01`,
	DROP COLUMN `1999-02`,
	DROP COLUMN `1999-03`,
	DROP COLUMN `1999-04`,
	DROP COLUMN `1999-05`,
	DROP COLUMN `1999-06`,
	DROP COLUMN `1999-07`,
	DROP COLUMN `1999-08`,
	DROP COLUMN `1999-09`,
	DROP COLUMN `1999-10`,
	DROP COLUMN `1999-11`,
	DROP COLUMN `1999-12`,
	DROP COLUMN `2000-01`,
	DROP COLUMN `2000-02`,
	DROP COLUMN `2000-03`,
	DROP COLUMN `2000-04`,
	DROP COLUMN `2000-05`,
	DROP COLUMN `2000-06`,
	DROP COLUMN `2000-07`,
	DROP COLUMN `2000-08`,
	DROP COLUMN `2000-09`,
	DROP COLUMN `2000-10`,
	DROP COLUMN `2000-11`,
	DROP COLUMN `2000-12`,
	DROP COLUMN `2001-01`,
	DROP COLUMN `2001-02`,
	DROP COLUMN `2001-03`,
	DROP COLUMN `2001-04`,
	DROP COLUMN `2001-05`,
	DROP COLUMN `2001-06`,
	DROP COLUMN `2001-07`,
	DROP COLUMN `2001-08`,
	DROP COLUMN `2001-09`,
	DROP COLUMN `2001-10`,
	DROP COLUMN `2001-11`,
	DROP COLUMN `2001-12`,
	DROP COLUMN `2002-01`,
	DROP COLUMN `2002-02`,
	DROP COLUMN `2002-03`,
	DROP COLUMN `2002-04`,
	DROP COLUMN `2002-05`,
	DROP COLUMN `2002-06`,
	DROP COLUMN `2002-07`,
	DROP COLUMN `2002-08`,
	DROP COLUMN `2002-09`,
	DROP COLUMN `2002-10`,
	DROP COLUMN `2002-11`,
	DROP COLUMN `2002-12`,
	DROP COLUMN `2003-01`,
	DROP COLUMN `2003-02`,
	DROP COLUMN `2003-03`,
	DROP COLUMN `2003-04`,
	DROP COLUMN `2003-05`,
	DROP COLUMN `2003-06`,
	DROP COLUMN `2003-07`,
	DROP COLUMN `2003-08`,
	DROP COLUMN `2003-09`,
	DROP COLUMN `2003-10`,
	DROP COLUMN `2003-11`,
	DROP COLUMN `2003-12`,
	DROP COLUMN `2004-01`,
	DROP COLUMN `2004-02`,
	DROP COLUMN `2004-03`,
	DROP COLUMN `2004-04`,
	DROP COLUMN `2004-05`,
	DROP COLUMN `2004-06`,
	DROP COLUMN `2004-07`,
	DROP COLUMN `2004-08`,
	DROP COLUMN `2004-09`,
	DROP COLUMN `2004-10`,
	DROP COLUMN `2004-11`,
	DROP COLUMN `2004-12`,
	DROP COLUMN `2005-01`,
	DROP COLUMN `2005-02`,
	DROP COLUMN `2005-03`,
	DROP COLUMN `2005-04`,
	DROP COLUMN `2005-05`,
	DROP COLUMN `2005-06`,
	DROP COLUMN `2005-07`,
	DROP COLUMN `2005-08`,
	DROP COLUMN `2005-09`,
	DROP COLUMN `2005-10`,
	DROP COLUMN `2005-11`,
	DROP COLUMN `2005-12`,
	DROP COLUMN `2006-01`,
	DROP COLUMN `2006-02`,
	DROP COLUMN `2006-03`,
	DROP COLUMN `2006-04`,
	DROP COLUMN `2006-05`,
	DROP COLUMN `2006-06`,
	DROP COLUMN `2006-07`,
	DROP COLUMN `2006-08`,
	DROP COLUMN `2006-09`,
	DROP COLUMN `2006-10`,
	DROP COLUMN `2006-11`,
	DROP COLUMN `2006-12`,
	DROP COLUMN `2007-01`,
	DROP COLUMN `2007-02`,
	DROP COLUMN `2007-03`,
	DROP COLUMN `2007-04`,
	DROP COLUMN `2007-05`,
	DROP COLUMN `2007-06`,
	DROP COLUMN `2007-07`,
	DROP COLUMN `2007-08`,
	DROP COLUMN `2007-09`,
	DROP COLUMN `2007-10`,
	DROP COLUMN `2007-11`,
	DROP COLUMN `2007-12`,
	DROP COLUMN `2008-01`,
	DROP COLUMN `2008-02`,
	DROP COLUMN `2008-03`,
	DROP COLUMN `2008-04`,
	DROP COLUMN `2008-05`,
	DROP COLUMN `2008-06`,
	DROP COLUMN `2008-07`,
	DROP COLUMN `2008-08`,
	DROP COLUMN `2008-09`,
	DROP COLUMN `2008-10`,
	DROP COLUMN `2008-11`,
	DROP COLUMN `2008-12`,
	DROP COLUMN `2009-01`,
	DROP COLUMN `2009-02`,
	DROP COLUMN `2009-03`,
	DROP COLUMN `2009-04`,
	DROP COLUMN `2009-05`,
	DROP COLUMN `2009-06`,
	DROP COLUMN `2009-07`,
	DROP COLUMN `2009-08`,
	DROP COLUMN `2009-09`,
	DROP COLUMN `2009-10`,
	DROP COLUMN `2009-11`,
	DROP COLUMN `2009-12`,
	DROP COLUMN `2017-01`,
	DROP COLUMN `2017-02`,
	DROP COLUMN `2017-03`;

-- get queries for horizontal summation of months
SELECT CONCAT('MODIFY COLUMN `',COLUMN_NAME,'` INT,')
FROM INFORMATION_SCHEMA.columns
WHERE (
	TABLE_NAME = 'housing_price'
	AND TABLE_SCHEMA = 'etl_project'
)
AND (
	COLUMN_NAME <> 'RegionName'
	AND COLUMN_NAME <> 'SizeRank'
);

-- ensure all datatypes are int
ALTER TABLE housing_price
	MODIFY COLUMN `2010-01` INT,
	MODIFY COLUMN `2010-02` INT,
	MODIFY COLUMN `2010-03` INT,
	MODIFY COLUMN `2010-04` INT,
	MODIFY COLUMN `2010-05` INT,
	MODIFY COLUMN `2010-06` INT,
	MODIFY COLUMN `2010-07` INT,
	MODIFY COLUMN `2010-08` INT,
	MODIFY COLUMN `2010-09` INT,
	MODIFY COLUMN `2010-10` INT,
	MODIFY COLUMN `2010-11` INT,
	MODIFY COLUMN `2010-12` INT,
	MODIFY COLUMN `2011-01` INT,
	MODIFY COLUMN `2011-02` INT,
	MODIFY COLUMN `2011-03` INT,
	MODIFY COLUMN `2011-04` INT,
	MODIFY COLUMN `2011-05` INT,
	MODIFY COLUMN `2011-06` INT,
	MODIFY COLUMN `2011-07` INT,
	MODIFY COLUMN `2011-08` INT,
	MODIFY COLUMN `2011-09` INT,
	MODIFY COLUMN `2011-10` INT,
	MODIFY COLUMN `2011-11` INT,
	MODIFY COLUMN `2011-12` INT,
	MODIFY COLUMN `2012-01` INT,
	MODIFY COLUMN `2012-02` INT,
	MODIFY COLUMN `2012-03` INT,
	MODIFY COLUMN `2012-04` INT,
	MODIFY COLUMN `2012-05` INT,
	MODIFY COLUMN `2012-06` INT,
	MODIFY COLUMN `2012-07` INT,
	MODIFY COLUMN `2012-08` INT,
	MODIFY COLUMN `2012-09` INT,
	MODIFY COLUMN `2012-10` INT,
	MODIFY COLUMN `2012-11` INT,
	MODIFY COLUMN `2012-12` INT,
	MODIFY COLUMN `2013-01` INT,
	MODIFY COLUMN `2013-02` INT,
	MODIFY COLUMN `2013-03` INT,
	MODIFY COLUMN `2013-04` INT,
	MODIFY COLUMN `2013-05` INT,
	MODIFY COLUMN `2013-06` INT,
	MODIFY COLUMN `2013-07` INT,
	MODIFY COLUMN `2013-08` INT,
	MODIFY COLUMN `2013-09` INT,
	MODIFY COLUMN `2013-10` INT,
	MODIFY COLUMN `2013-11` INT,
	MODIFY COLUMN `2013-12` INT,
	MODIFY COLUMN `2014-01` INT,
	MODIFY COLUMN `2014-02` INT,
	MODIFY COLUMN `2014-03` INT,
	MODIFY COLUMN `2014-04` INT,
	MODIFY COLUMN `2014-05` INT,
	MODIFY COLUMN `2014-06` INT,
	MODIFY COLUMN `2014-07` INT,
	MODIFY COLUMN `2014-08` INT,
	MODIFY COLUMN `2014-09` INT,
	MODIFY COLUMN `2014-10` INT,
	MODIFY COLUMN `2014-11` INT,
	MODIFY COLUMN `2014-12` INT,
	MODIFY COLUMN `2015-01` INT,
	MODIFY COLUMN `2015-02` INT,
	MODIFY COLUMN `2015-03` INT,
	MODIFY COLUMN `2015-04` INT,
	MODIFY COLUMN `2015-05` INT,
	MODIFY COLUMN `2015-06` INT,
	MODIFY COLUMN `2015-07` INT,
	MODIFY COLUMN `2015-08` INT,
	MODIFY COLUMN `2015-09` INT,
	MODIFY COLUMN `2015-10` INT,
	MODIFY COLUMN `2015-11` INT,
	MODIFY COLUMN `2015-12` INT,
	MODIFY COLUMN `2016-01` INT,
	MODIFY COLUMN `2016-02` INT,
	MODIFY COLUMN `2016-03` INT,
	MODIFY COLUMN `2016-04` INT,
	MODIFY COLUMN `2016-05` INT,
	MODIFY COLUMN `2016-06` INT,
	MODIFY COLUMN `2016-07` INT,
	MODIFY COLUMN `2016-08` INT,
	MODIFY COLUMN `2016-09` INT,
	MODIFY COLUMN `2016-10` INT,
	MODIFY COLUMN `2016-11` INT,
	MODIFY COLUMN `2016-12` INT;

-- get queries for horizontal summation of months
SELECT CONCAT('`',COLUMN_NAME,'`+')
FROM INFORMATION_SCHEMA.columns
WHERE (
	TABLE_NAME = 'housing_price'
	AND TABLE_SCHEMA = 'etl_project'
)
AND (
	left(COLUMN_NAME, 4) IN ('2010')
)
AND (
	COLUMN_NAME <> 'RegionName'
	AND COLUMN_NAME <> 'SizeRank'
);

-- create view for sums across each year of interest
CREATE VIEW housing_view AS (
	SELECT RegionName,SizeRank,
		`2010-01`+`2010-02`+`2010-03`+`2010-04`+`2010-05`+`2010-06`+`2010-07`+`2010-08`+`2010-09`+`2010-10`+`2010-11`+`2010-12` AS y_2010,
		`2011-01`+`2011-02`+`2011-03`+`2011-04`+`2011-05`+`2011-06`+`2011-07`+`2011-08`+`2011-09`+`2011-10`+`2011-11`+`2011-12` AS y_2011,
		`2012-01`+`2012-02`+`2012-03`+`2012-04`+`2012-05`+`2012-06`+`2012-07`+`2012-08`+`2012-09`+`2012-10`+`2012-11`+`2012-12` AS y_2012,
		`2013-01`+`2013-02`+`2013-03`+`2013-04`+`2013-05`+`2013-06`+`2013-07`+`2013-08`+`2013-09`+`2013-10`+`2013-11`+`2013-12` AS y_2013,
		`2014-01`+`2014-02`+`2014-03`+`2014-04`+`2014-05`+`2014-06`+`2014-07`+`2014-08`+`2014-09`+`2014-10`+`2014-11`+`2014-12` AS y_2014,
		`2015-01`+`2015-02`+`2015-03`+`2015-04`+`2015-05`+`2015-06`+`2015-07`+`2015-08`+`2015-09`+`2015-10`+`2015-11`+`2015-12` AS y_2015,
		`2016-01`+`2016-02`+`2016-03`+`2016-04`+`2016-05`+`2016-06`+`2016-07`+`2016-08`+`2016-09`+`2016-10`+`2016-11`+`2016-12` AS y_2016
	FROM housing_price
);

SELECT * FROM housing_view;